<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>每日签到</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <script src="../../assets/js/jquery.min.js" type="text/javascript"></script>
    <script src="../../assets/js/sapi.js"></script>
    <style type="text/css">
        .circle {
            height: 160px;
            width: 160px;
            border: 10px solid #FFDF2B;
            text-align: center;
            border-radius: 50%;
            position:relative;
            background-color:#F5FFFA
        }
        .linear{ 

            width:100%; 

            /*background: -ms-linear-gradient(top, #ff6a00, #ffffff);         IE 10 #87CEFA 

            background:-moz-linear-gradient(top,#ff6a00, #ffffff);火狐 

            background: -webkit-linear-gradient(top, #ff6a00, #ffffff);   Safari5.1 Chrome 10+*/
        } 
        #bg {
            display: none;
            position: absolute;
            top: 0%;
            left: 0%;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 1001;
            -moz-opacity: 0.7;
            opacity: .70;
            filter: alpha(opacity=70);
        }

        #show {
            display: none;
            position: absolute;
            top: 25%;
            left: 22%;
            width: 53%;
            height: 49%;
            padding: 8px;
            background-color: none;
            z-index: 1002;
            overflow: auto;
        }
    </style>
</head>

<body style="background-color:#FF6a00"><!--#7EC0EE-->

    <div id="bg" onclick="hidediv()"></div>
    <div id="show" style="text-align:center" onclick="hidediv()">
        <div style="font-size:25px;font-weight:900;font-family:YouYuan;"><font color="#ffffff">App签到成功!</font></div><br>
        <div style="font-size:25px;font-weight:900;font-family:YouYuan;"><font color="#ff0000">+<font id="showadd"></font> 积分</font></div><br>
        <img src="../../image/coin.png" style="width:100px;height:100px">
        
    </div>

    <div class="linear" style="text-align:center;">
        <br>
        <br>

        <div style="font-size:20px;font-family:YouYuan;font-weight:900;">
            <font color="#ffffff" id="date"></font>
        </div>

        <br>
        <div class="circle" style="left:50%;margin-left:-90px" id="signbox" onclick="check()">
            <span style="position:absolute;top:60px;left:50px;font-size:32px;font-family:YouYuan;font-weight:900;">
                <font color="#7EC0EE" id="signtext">签到</font>
            </span>
        </div>
        
        <br>
        <br>

    </div>

    <div style="font-size:16px;font-family:YouYuan;font-weight:900;margin-top:10px">
        <font color="#ffffff">每日签到</font>
    </div>
    <hr width="100%" color=#ffffff size=2 />

    <div id="content">
        <!--<br><br><br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">您今天还没有签到哦^-^</font>
        </div>

        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">今日签到可获得&nbsp;&nbsp;<font size="6" color="#FFD700">15</font>&nbsp;&nbsp;积分!</font>
        </div>

        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">您当前拥有的积分总额为&nbsp;&nbsp;<font size="6" color="#FFD700">100</font>&nbsp;&nbsp;积分!</font>
        </div>-->

        <!--<br>
        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">任务完成，您今日签到获得了&nbsp;&nbsp;<font size="6" color="#FFD700">10</font>&nbsp;&nbsp;积分!</font>
        </div>

        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">明日签到可获得&nbsp;&nbsp;<font size="6" color="#FFD700">15</font>&nbsp;&nbsp;积分!</font>
        </div>

        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">您当前拥有的积分总额为&nbsp;&nbsp;<font size="6" color="#FFD700">100</font>&nbsp;&nbsp;积分!</font>
        </div>-->
    </div>

    <!--签到前-->
    <script src="../../script/template.js"></script>
    <script type="text/html" id="tmp">
        <br>
        <br>
        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">您今天还没有签到哦^-^</font>
        </div>

        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">今日签到可获得&nbsp;&nbsp;<font size="6" color="#FFD700" id="add">{{add}}</font>&nbsp;&nbsp;积分!</font>
        </div>

        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">您当前拥有的积分总额为&nbsp;&nbsp;<font size="6" color="#FFD700">{{total}}</font>&nbsp;&nbsp;积分!</font>
        </div>
    </script>
    <!--签到后-->
    <script type="text/html" id="tmp2">
        <br>
        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">任务完成，您今日签到获得了&nbsp;&nbsp;<font size="6" color="#FFD700">{{add}}</font>&nbsp;&nbsp;积分!</font>
        </div>

        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">明日签到可获得&nbsp;&nbsp;<font size="6" color="#FFD700">{{tadd}}</font>&nbsp;&nbsp;积分!</font>
        </div>

        <br>
        <div style="text-align:center;font-family:YouYuan;font-weight:900">
            <font color="#ffffff">您当前拥有的积分总额为&nbsp;&nbsp;<font size="6" color="#FFD700">{{total}}</font>&nbsp;&nbsp;积分!</font>
        </div>
    </script>
    <script>

        apiready = function () {
            api.showProgress({
                style: 'default',
                animationType: 'fade',
                title: '加载...',
                text: '',
                modal: true
            });

            var mydate = new Date();
            var str = "" + mydate.getFullYear() + "年";
            str += (mydate.getMonth() + 1) + "月";
            str += mydate.getDate() + "日";
            //document.getElementById('date').innerText = str;//今日日期
            $("#date").text(str);

            var d = api.pageParam.data;
            var html = template('tmp', d);
            $('#content').append(html);
            api.hideProgress();
        }

        function check() {
            if (document.getElementById('signtext').innerText == '签到') {
                var html = "<img src='../../image/success.png' style='width:96px;'>" +
                            "<span style='position:absolute;top:100px;left:32px;font-size:24px;font-family:YouYuan;font-weight:900;'>" +
                            "<font color='#7EC0EE'>签到完成</font></span>";
                $('#signbox').html(html);

                //showdiv();

                var map = api.require('bMap');
                var address = '';
                map.getNameFromCoords({
                    lon: localStorage["lon"],
                    lat: localStorage["lat"]
                }, function (ret, err) {
                    if (ret.status) {
                        address = ret.address;
                    }
                });

                var add=parseInt( $("#add").text());//今日获得的积分
                
                post(dburl.task.signsuccess, {
                    values: {
                        add: add,
                        lon: localStorage["lon"],
                        lat: localStorage["lat"],
                        address: address
                    }
                }, function () {
                    post(dburl.task.signcheck, { values: {} }, function (r) {
                        var html = template('tmp2', r.D);
                        $('#content').html(html);
                        $('#showadd').text(r.D.add);
                        //需要发送一个见到成功的事件
                        api.sendEvent({ name: "sign_success" });
                        showdiv();
                    })
                })
            }
        }

        function showdiv() {
            document.getElementById("bg").style.display = "block";
            document.getElementById("show").style.display = "block";
        }

        function hidediv() {
            document.getElementById("bg").style.display = 'none';
            document.getElementById("show").style.display = 'none';
        }
    </script>
</body>
</html>
