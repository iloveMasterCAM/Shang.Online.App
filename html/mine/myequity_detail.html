<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>头部</title>
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <link rel="stylesheet" href="../../css/aui.css">
    <link rel="stylesheet" href="../../css/aui_iconfont.ttf">
    <link rel="stylesheet" href="../../css/all.css">
    <link rel="stylesheet" href="../../css/store.css">
    <link rel="stylesheet" href="../../css/tanchuang.css">

    <script src="../../assets/js/jquery.min.js"></script>
    <script src="../../assets/js/api.js"></script>
    <script src="../../assets/js/sapi.js"></script>
    <script src="../../script/artTemplate.js"></script>
</head>
<body>

    <!--内容-->
    <div id="content" class="clear">
        <!--头部-->
        <div class="top">
            <header class="aui-bar aui-bar-nav redbg" style="height: 48px;">
                <ul >
                    <li class="aui-pull-left">
                        <i class="aui-iconfont aui-icon-left" ontouchend="closeWin()"></i>
                    </li>
                    <li>
                        <span class="aui-title" id="title">&nbsp;</span>
                    </li>
                </ul>
            </header>
        </div>
        <!--遮罩层-->
        <div id="mark" class="aui-mask"></div>
    </div>

</body>
<script type="text/html" id="tmp">
    <!--分红记录-->
    <div class="redbg firstdiv clear">
        <ol class=" aui-text-center">
            <li class="mtext"><span>{{dtime}} 分红(元)</span></li>
            <li style="font-size: 33px;font-weight: 500"><span>{{dmoney}}</span></li>
            <li onclick="openWin('equity-dividend_personal','../equity/dividend_personal.html','{{eid}}')"><div class="aui-btn mtext">分红记录</div></li>
        </ol>
    </div>
    <div style="clear: both;position: relative;top: 48px;">
        <!--分红率和分红周期-->
        <div class="seconddiv aui-text-center redtext mtext">
            <span>分红率{{ep}}%,分红周期({{cycle}})</span>
        </div>
        <!--分红-->
        <div class="thirddiv aui-text-left">
            <ul>
                <li class="aui-col-xs-6 ">
                    <span class="mtext navtext">分红池(元)</span><br/>
                    <span class="maxtext titletext" style="font-weight: 500">{{pool}}</span>
                </li>
                <li class="aui-col-xs-6">
                    <span class="mtext navtext">市场分红权(份)</span><br/>
                    <span class="maxtext titletext" style="font-weight: 500">{{selling}}</span>
                </li>
            </ul>
        </div>
        <!--店铺-->
        <div class="fourthdiv" onclick="openWin('store-shopgoodslist_head','../store/shopgoodslist_head.html','{{oid}}')">
            <div class="redbg rectangle aui-col-xs-1"></div>
            <div>
                <span class="xtext titletext">{{sname}}</span>
                <i class="aui-iconfont aui-icon-right aui-pull-right navtext"></i>
            </div>
        </div>
        <!--价格-->
        <div class="fifthdiv">
            <ul>
                <li class="aui-col-xs-4 aui-text-center">
                    <span class="mtext navtext">当前价格</span><br/>
                    <span class="mtext redtext">￥{{minprice}} - {{maxprice}}</span>
                </li>
                <li class="aui-col-xs-4 aui-text-center">
                    <span class="mtext navtext">购买价格</span><br/>
                    <span class="mtext redtext">￥{{buyprice}}</span>
                </li>
                <li class="aui-col-xs-4 aui-text-center">
                    <span class="mtext navtext">市场价值</span><br/>
                    <span class="mtext redtext">￥{{value}}</span>
                </li>
            </ul>
        </div>
        <!--查看企业-->
        <div class="sixthdiv">
            <div class="rectangle aui-col-xs-1" style="background-color: #7fbcf1;top: 7px;"></div>
            <div>
                <span class="mtext titletext">{{oname}}</span>
                <p class="aui-pull-right">
                    <span class="mtext navtext" onclick="openWin('organize-organize_detail','../organize/organize_detail.html','{{oid}}')">查看企业</span>
                    <i class="aui-iconfont aui-icon-right navtext"></i>
                </p>
            </div>
        </div>
    </div>

    <!--买入和卖出-->
    <div class="aui-nav aui-text-center" style="height: 48px">
        <ol>
            <li class="aui-col-xs-6" onclick="openWin('market-list_market','../market/list_market.html','{{eid}}')"><span class="xtext" style="color: #9bdc2b">买入</span></li>
            <li class="aui-col-xs-6" onclick="showDia()"><span class="xtext redtext">卖出</span></li>
        </ol>
    </div>
    <!--弹窗-->
    <div class="aui-dialog clearfix" id="selldialog">
        <div class="aui-dialog-header">
            <img style="width: 100%;" src="../../image/mine/tanch.png"/>
        </div>
        <div class="aui-dialog-body aui-text-center">
            <span class="titletext xtext">{{ename}}</span><br/>
            <span class="titletext mtext"> 持有数量:</span>
            <span class="mtext" style="color: #f34b4b">{{keep}}份</span>
            <form>
                <div class="aui-col-xs-6" style="margin: 25px 15px 28px;">
                    <span class="titletext mtext aui-col-xs-4">单价:</span>
                    <input id="price" type="number" class="aui-input" onkeypress="return (/[\d.]/.test(String.fromCharCode(event.keyCode)))"/>
                </div>
                <div class="aui-col-xs-6">
                    <span class="titletext mtext aui-col-xs-4">数量:</span>
                    <input id="num" type="number" class="aui-input" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')"/>
                </div>
            </form>

        </div>
        <div class="aui-dialog-footer">
            <div class="aui-dialog-btn mtext titletext" id="cancel" onclick="cancle()">取消</div>
            <div class="aui-dialog-btn mtext" id="sell" onclick="sell('{{mid}}')">卖出</div>
        </div>
    </div>
</script>
<script src="../../script/myDialog.js"></script>
<script>
    apiready = function () {
        eid = api.pageParam.data;

        api.showProgress({
            style: 'default',
            animationType: 'fade',
            title: '加载中...',
            text: '',
            modal: false
        });

        post(dburl.equity.udetail_equities, { values: { id: eid } }, function (d) {
            var html = template('tmp', d.D);
            var title = d.D.ename;
            $('#title').html(title);
            $('#content').append(html);
            api.hideProgress();
        })
    };

    var showDia = function () {
        show(selldialog);
        show(mark);
    };

    var cancle = function () {
        hide(selldialog);
        hide(mark);
    };

    var sell = function (mid) {
        var num = $('#num').val();
        var price = $('#price').last().val();

        if (num == null || num == '' || price == null || price == '') {
            api.toast({
                msg: '请输入出售信息或您的输入有误..',
                duration: 2000,
                location: 'bottom'
            });
            return;
        }

        if (isNaN(num) && isNaN(price)) {
            api.toast({
                msg: '请的输入有误..',
                duration: 2000,
                location: 'bottom'
            });
            return;
        }

        api.confirm({
            title: '商加在线提示',
            msg: '您将以' + price + '元/份出售' + num + '份此分红权.',
            button: ['确定', '取消']
        }, function (ret, err) {
            if (ret.buttonIndex == 2) {
                api.showProgress({
                    style: 'default',
                    animationType: 'fade',
                    title: '请稍候...',
                    text: '',
                    modal: true
                });
                post(dburl.market.sell_markets, { values: { id: mid, count: num, price: price } }, function (r) {
                    if (r.S) {

                        api.hideProgress();
                        cancle();
                        api.toast({
                            msg: '您的分红权已在交易市场上架!',
                            duration: 3000,
                            location: 'middle'
                        });
                    }
                    else {
                        api.hideProgress();
                        api.toast({
                            msg: r.M,
                            duration: 3000,
                            location: 'bottom'
                        });
                    }
                    api.hideProgress();
                })
            }
            else { }
        })
    }
</script>

</html>